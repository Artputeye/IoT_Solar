<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WiFi Scanner</title>
<style>
  body { font-family: system-ui, sans-serif; margin: 24px; }
  .card { max-width: 520px; padding: 16px; border-radius: 14px; box-shadow: 0 10px 20px rgba(0,0,0,.08); }
  button, select { padding: 10px 12px; border-radius: 10px; border: 1px solid #ddd; }
  button { cursor: pointer; }
  .row { display:flex; gap:8px; align-items:center; margin: 12px 0; }
  .muted { color:#666; font-size: 0.9rem; }
</style>
</head>
<body>
  <div class="card">
    <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ Wi-Fi</h2>
    <div class="row">
      <select id="ssidSelect">
        <option value="" disabled selected>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‚Ä¶</option>
      </select>
      <button id="scanBtn">‡∏™‡πÅ‡∏Å‡∏ô</button>
    </div>
    <div class="muted" id="status">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πÅ‡∏Å‡∏ô</div>
  </div>

<script>
async function scanWifi() {
  const status = document.getElementById('status');
  const sel = document.getElementById('ssidSelect');
  status.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô‚Ä¶';
  sel.innerHTML = '<option disabled selected>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô‚Ä¶</option>';
  try {
    const res = await fetch('/scan', {cache:'no-store'});
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const list = await res.json(); // [{ssid, rssi, secure}, ...]
    sel.innerHTML = '';
    if (!list.length) {
      sel.innerHTML = '<option disabled selected>‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢</option>';
      status.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢';
      return;
    }
    // ‡πÄ‡∏ï‡∏¥‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á dropdown
    for (const ap of list) {
      const opt = document.createElement('option');
      const lock = ap.secure ? 'üîí' : 'üîì';
      opt.value = ap.ssid;
      opt.textContent = `${ap.ssid}  (${ap.rssi} dBm) ${lock}`;
      sel.appendChild(opt);
    }
    status.textContent = `‡∏û‡∏ö ${list.length} ‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢`;
  } catch (e) {
    console.error(e);
    status.textContent = '‡∏™‡πÅ‡∏Å‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß';
    sel.innerHTML = '<option disabled selected>‡∏™‡πÅ‡∏Å‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</option>';
  }
}

document.getElementById('scanBtn').addEventListener('click', scanWifi);
// ‡∏™‡πÅ‡∏Å‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
window.addEventListener('load', scanWifi);
</script>
</body>
</html>